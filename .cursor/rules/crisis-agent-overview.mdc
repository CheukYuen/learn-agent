---
description: 
globs: 
alwaysApply: true
---
# Crisis Agent - 智能告警分析系统总览

## 项目概述

Crisis Agent 是一个智能告警分析系统，采用**两阶段流水线架构**：
1. **分类阶段**：将告警分类为特定类型
2. **专业分析阶段**：应用类型特定的分析逻辑

## 核心架构

### 主要系统
- **新分类系统**（推荐）：基于工作流的高级告警分类和专业分析
- **旧版系统**：原始 `AlertAnalysisAgent` 类（向后兼容）

### 关键组件

#### 工作流引擎
- **主入口**：[crisis/workflow.py](mdc:crisis/workflow.py)
  - `analyze_alert()` - 新的主分析函数
  - `route()` - 原始通用路由函数（遗留）

#### 分类系统
- **分类提示**：[crisis/alert-classification-prompt.md](mdc:crisis/alert-classification-prompt.md)
  - 支持分类：`javascript_error`, `uni_error`, `backend_api_error`
  - 输出结构化 XML 格式

#### 专业分析提示
- **Uni 错误**：[crisis/uni-error-prompt.md](mdc:crisis/uni-error-prompt.md)
- **JavaScript 错误**：[crisis/javascript-error-prompt.md](mdc:crisis/javascript-error-prompt.md)  
- **后端 API 错误**：[crisis/backend-api-error-prompt.md](mdc:crisis/backend-api-error-prompt.md)

## 支持的告警类型

| 类型 | 用途 | 关键特性 | 关键词 |
|------|------|----------|--------|
| `uni_error` | Uni JS Bridge 错误 | 内置错误码映射 (10001-10019) | uni, bridge, 桥接, 移动端 |
| `javascript_error` | 前端 JavaScript 运行时错误 | 堆栈跟踪分析 | JavaScript, JS, TypeError, ReferenceError |
| `backend_api_error` | 服务端 API 系统错误 | HTTP 状态分析 | API, 接口, 服务器, 数据库, 超时 |

## 核心技术

- **Python** 核心实现
- **模板化提示**：Markdown 模板 + 变量替换
- **两阶段 LLM 流水线**：分类 → 专业分析
- **结构化 XML 输出**：一致的可解析分析结果
- **模式匹配**：关键词和错误码识别

## 开发工作流

1. **分类改进**：修改分类提示，添加新类别
2. **专业分析改进**：编辑特定提示文件
3. **测试验证**：使用 [crisis/example_usage.py](mdc:crisis/example_usage.py)

## 文件优先级

1. [crisis/workflow.py](mdc:crisis/workflow.py) - 主工作流逻辑
2. [crisis/alert-classification-prompt.md](mdc:crisis/alert-classification-prompt.md) - 分类规则
3. [crisis/*-error-prompt.md](mdc:crisis/uni-error-prompt.md) - 专业分析逻辑
4. [crisis/example_usage.py](mdc:crisis/example_usage.py) - 测试验证
