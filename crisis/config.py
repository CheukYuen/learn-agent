"""
配置文件，包含错误码映射、知识库和其他配置信息
"""

# 扩展的错误码映射
ERROR_CODE_MAPPING = {
    # 系统错误 (10000-10099)
    "10001": "系统内部错误",
    "10002": "参数错误", 
    "10003": "权限不足",
    "10004": "资源不存在",
    "10005": "网络连接超时",
    "10006": "数据库连接失败",
    "10007": "服务不可用",
    "10008": "配置错误",
    "10009": "内存不足",
    "10010": "磁盘空间不足",
    "10011": "CPU使用率过高",
    "10012": "线程池耗尽",
    "10013": "缓存失效",
    "10014": "文件系统错误",
    "10015": "uni请求失败",
    
    # 网络错误 (10100-10199)
    "10101": "DNS解析失败",
    "10102": "SSL握手失败", 
    "10103": "代理服务器错误",
    "10104": "负载均衡器异常",
    "10105": "防火墙阻止",
    
    # 数据库错误 (10200-10299)
    "10201": "数据库查询超时",
    "10202": "死锁检测",
    "10203": "表锁等待超时",
    "10204": "主从同步延迟",
    "10205": "连接池耗尽",
    
    # 业务逻辑错误 (10300-10399) 
    "10301": "用户认证失败",
    "10302": "令牌过期",
    "10303": "访问频率限制",
    "10304": "业务规则违反",
    "10305": "数据验证失败",
}

# 历史数据知识库示例
KNOWLEDGE_BASE = {
    "incident_001": {
        "description": "uni服务请求超时，用户无法登录",
        "cause": "uni服务器负载过高，响应时间超过阈值",
        "solution": "重启uni服务，优化数据库查询",
        "prevention": "增加服务器监控，设置自动扩容",
        "severity": "高",
        "duration": "2小时"
    },
    "incident_002": {
        "description": "数据库连接失败，系统无法读取用户数据",
        "cause": "数据库连接池耗尽，新连接无法建立",
        "solution": "重启数据库连接池，清理僵尸连接",
        "prevention": "优化连接池配置，添加连接泄露检测",
        "severity": "高",
        "duration": "1小时"
    },
    "incident_003": {
        "description": "CPU使用率持续90%以上，系统响应缓慢",
        "cause": "后台批处理任务占用大量CPU资源",
        "solution": "调整批处理任务调度，限制并发数",
        "prevention": "实施资源隔离，优化算法效率",
        "severity": "中",
        "duration": "30分钟"
    },
    "incident_004": {
        "description": "磁盘空间不足，日志写入失败",
        "cause": "日志文件未及时清理，磁盘使用率达到95%",
        "solution": "清理历史日志，扩展磁盘容量",
        "prevention": "建立日志轮转机制，设置磁盘告警",
        "severity": "中",
        "duration": "45分钟"
    }
}

# 关键词-影响严重性映射
SEVERITY_KEYWORDS = {
    "严重": {
        "weight": 5,
        "keywords": ["系统崩溃", "服务中断", "数据丢失", "安全漏洞", "完全不可用", "灾难性"]
    },
    "高": {
        "weight": 4, 
        "keywords": ["大规模影响", "核心功能异常", "用户无法访问", "业务中断", "紧急"]
    },
    "中": {
        "weight": 3,
        "keywords": ["性能下降", "响应延迟", "部分功能异常", "连接不稳定", "间歇性故障"]
    },
    "低": {
        "weight": 2,
        "keywords": ["轻微影响", "个别用户反馈", "功能降级", "可接受延迟"]
    },
    "信息": {
        "weight": 1,
        "keywords": ["警告", "提醒", "建议", "优化", "维护", "信息"]
    }
}

# 系统组件关键词
SYSTEM_COMPONENTS = [
    "数据库", "MySQL", "PostgreSQL", "Redis", "MongoDB",
    "网络", "负载均衡", "CDN", "DNS", "防火墙",
    "存储", "磁盘", "文件系统", "备份",
    "CPU", "内存", "内存泄露", "线程",
    "uni", "API", "微服务", "容器", "Docker", "Kubernetes",
    "缓存", "消息队列", "MQ", "Kafka", "RabbitMQ",
    "认证", "权限", "SSL", "证书",
    "监控", "日志", "告警"
]

# 默认配置
DEFAULT_CONFIG = {
    "similarity_threshold": 0.6,  # 历史事件相似度阈值
    "max_historical_matches": 3,  # 最大历史匹配数量
    "enable_code_analysis": True,  # 是否启用代码分析
    "log_level": "INFO",
    "analysis_timeout": 30,  # 分析超时时间（秒）
}

# 响应措施模板
RESPONSE_TEMPLATES = {
    "uni": {
        "immediate": [
            "检查uni服务状态和健康检查端点",
            "查看uni服务日志，识别错误模式",
            "验证uni服务依赖的下游服务状态",
            "如有必要，重启uni服务实例"
        ],
        "long_term": [
            "优化uni服务的错误处理和重试机制",
            "实施服务熔断和降级策略",
            "增强uni服务监控和告警",
            "进行负载测试和性能优化"
        ]
    },
    "database": {
        "immediate": [
            "检查数据库连接状态和活跃连接数",
            "查看数据库慢查询日志",
            "验证数据库服务器资源使用情况",
            "检查数据库锁等待和死锁情况"
        ],
        "long_term": [
            "优化数据库查询性能和索引策略",
            "调整数据库连接池配置",
            "实施数据库分库分表策略",
            "建立数据库性能基线和告警"
        ]
    },
    "network": {
        "immediate": [
            "检查网络连通性和路由配置",
            "验证DNS解析和负载均衡状态", 
            "查看网络设备日志和错误统计",
            "测试服务间网络延迟"
        ],
        "long_term": [
            "优化网络架构和冗余设计",
            "实施网络监控和流量分析",
            "建立网络故障自动切换机制",
            "定期进行网络压力测试"
        ]
    },
    "resource": {
        "immediate": [
            "检查系统资源使用情况（CPU、内存、磁盘）",
            "识别资源消耗最高的进程",
            "清理临时文件和释放不必要资源",
            "调整进程优先级和资源限制"
        ],
        "long_term": [
            "实施资源监控和容量规划",
            "优化应用程序资源使用效率",
            "建立资源告警和自动扩容机制",
            "定期进行性能调优"
        ]
    }
} 